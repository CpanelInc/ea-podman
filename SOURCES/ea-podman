#!/usr/local/cpanel/3rdparty/bin/perl
# cpanel - ea-podman                               Copyright 2022 cPanel, L.L.C.
#                                                           All rights Reserved.
# copyright@cpanel.net                                         http://cpanel.net
# This code is subject to the cPanel license. Unauthorized copying is prohibited

use strict;
use warnings;

package scripts::ea_podman;

use FindBin;

BEGIN {
    use FindBin;
    if ( -l $0 ) {    # i.e. /usr/local/cpanel/scripts/ea-podman ➜ /opt/cpanel/ea-podman/bin/ea-podman
        $0 = readlink($0);
        FindBin->again;
    }
}
use lib "$FindBin::Bin/lib", "$FindBin::Bin/../lib/";
use ea_podman::util;
use ea_podman::subids;

use Cpanel::Config::Users ();

run(@ARGV) unless caller;

# can do more functionality and verbosity levels as needed
sub run {
    ea_podman::subids::assert_has_user_namespaces(1);

    my $subuid_lu = ea_podman::subids::get_subuids();
    my $subgid_lu = ea_podman::subids::get_subgids();

    for my $user ( Cpanel::Config::Users::getcpusers() ) {
        print( exists $subuid_lu->{$user} ? "$ea_podman::subids::good “$user” has subuids ($subuid_lu->{$user})\n" : "$ea_podman::subids::bad “$user” does not have subuids\n" );
        print( exists $subgid_lu->{$user} ? "$ea_podman::subids::good “$user” has subgids ($subgid_lu->{$user})\n" : "$ea_podman::subids::bad “$user” does not have subgids\n" );
    }
}

1;
